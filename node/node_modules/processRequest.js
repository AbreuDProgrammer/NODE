var http = require('http'); 

var criarProcessRequest = function(porta){ 
	var entrada = {}; // API de entrada
	var caminhos = {}; // Rota de comunicação
	var metodos = ['GET','POST']; // Os metodos que serão percorridos
	metodos.forEach(function(metodo){ // Percorre duas veses passando pelos metodos get e post
		caminhos[metodo] = {};
		entrada[metodo.toLowerCase()] = function(path, fn){ // Cria uma biblioteca que designa os nomes dos gets e pots, ex /Cursos ou /Pessoas
			caminhos[metodo][path] = fn;
		};
	});
	http.createServer(function(req,res){
		res.setHeader('Access-Control-Allow-Origin','*');
		// Caso o caminho digitado não esteja guardado no array associativo, o user é redirecionado para a pagina 404 e o servidor encerra
		if(!caminhos[req.method][req.url]){
			res.statusCode = 404;
			return res.end(); // Retorna para garantir que o código não passa daqui, e encerra a ligação com o servidor
		}
		caminhos[req.method][req.url](req,res); // executa o caminhos[GET]['/pessoas'](req,res); declaramos no index
	}).listen(porta); // Define a porta passado no parametro da biblioteca criarProcessRequest
	return entrada; // Retorna
};

module.exports = criarProcessRequest; // Exporta a biblioteca com a funcionalidade de criar o servidor e definir as funcionalidades de cada url